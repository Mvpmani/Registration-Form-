<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cetas Walk-in Interview Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css?family=Exo:400,700" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
</head>

<body>
   
   
    <div class="container" id="form-container">
        <h2 class="mb-4">Cetas Walkin-Registration Form</Form></h2>
        <form id="registrationForm" >
            
            <div class="form-group mb-3">
                <div>
                <label for="fullname" class="form-label" >Candidate Full Name</label></div>
               <div>
                <input type="text" class="form-control" name="fullname" id="fullname"  required>
            </div></div>
            <div id="fullname-error" class="text-danger"></div>
            <div class="form-group mb-3">
                <div>
                    <label for="email" class="form-label" >Candidate Email</label></div>
                   <div>
                <div>
                <input type="email" class="form-control" name="email" id="email" required  onchange="validateEmail(this)">
                </div>

            </div>
            <div id="email-error" class="text-danger"></div>
            <div class="form-group mb-3">
                <div>
                    <label for="Candidate Contact No" class="form-label" >Candidate Contact No</label></div>
                   <div>
               <div>
                <input type="text" class="form-control" name="phone" id="phone"  required>
                </div>
            </div>
            <div class="form-group mb-3">
                <div>
                    <label for="Date of Birth" class="form-label" >Date of Birth</label></div>
                   <div>
                    <div>
                <input type="date" class="form-control" name="dob" id="dob"  required>
                </div>
            </div>
            <div class="form-group mb-3">
                <div>
                    <label for="Gender" class="form-label">Gender</label>
                </div>

                <select class="form-control" name="Gender" id="Gender" required>
                    <option value="" disabled selected>Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
            </div>
            <div class="form-group mb-3">
                <div>
                    <label for="MaritalStatus" class="form-label">Marital Status</label>
                </div>

                <select class="form-control" name="MaritalStatus" id="MaritalStatus" required>
                    <option value="" disabled selected>Select</option>
                    <option value="Single">Single</option>
                    <option value="Married">Married</option>
                </select>
            </div>
            <div class="form-group mb-3">
                <div>
                    <label for="College Name" class="form-label">College Name</label>
                </div>

                <input type="text" class="form-control" name="college" id="college" required>
            </div>
            <div class="form-group mb-3">
                <div>
                    <label for="Education Qualification" class="form-label">Education Qualification</label>
                </div>

                <select class="form-control" name="education" id="education" required>
                    <option value="" disabled selected>Select</option>
                    <option value="B.E Computer Science and Engineering">B.E Computer Science and Engineering</option>
                    <option value="M.Sc Computer Science">M.Sc Computer Science</option>
                    <option value="MCA">MCA</option>
                    <option value="B.Tech Information Technology">B.Tech Information Technology</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group mb-3" id="specialization-container" style="display: none;">
                <div>
                    <label for="Specialization" class="form-label">If other, mention your qualification</label>
                </div>
                <input type="text" class="form-control" name="Specialization" id="Specialization">
            </div>

            <div class="form-group mb-3">
                <div>
                    <label for="Year of Passing" class="form-label">Year of Passing</label>
                </div>

                <select class="form-control" name="YOP" id="YOP" required>
                    <option value="" disabled selected>Select</option>
                    <option value="2025">2025</option>
                    <option value="2024">2024</option>
                    <option value="2023">2023</option>

                </select>
            </div>
            <div class="form-group mb-3 ">
                <div>
                    <label for="Expertise Functional or Technical" class="form-label">Expertise Functional or
                        Technical</label>
                </div><select class="form-control" name="FunctionalOrTechnical" id="FunctionalOrTechnical" required>
                    <option value="" disabled selected>Select</option>
                    <option value="Functional">Functional</option>
                    <option value="Technical">Technical</option>
                    <option value="Techno-Functional">Techno-Functional</option>
                </select>
            </div>
            <div class="form-group mb-3"> 
                <div>
                    <label for="Are you Fresher or Experienced?" class="form-label">Are you Fresher or Experienced?</label>
                </div>

                <select class="form-control"
                name="FresherOrExperience" id="FresherOrExperience" required>
                <option value="" disabled selected>Select</option>
                <option value="Fresher">Fresher</option>
                <option value="Experience">Experienced</option>
            </select> </div>

            
            <div class="form-group mb-3 same-domain-field" style="display: none;">
                <div>
                    <label for="Experienced in Same Domain" class="form-label">Experienced in Same Domain</label>
                </div>
                <div>
                <select class="form-control" name="SameDomainExperience" id="SameDomainExperience">
                    <option value="" disabled selected>Select</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
                </div>
            </div>
            
                <div class="form-group mb-3 exclude-for-freshers" style="display: none;">
                    <div>
                        <label for="Mention your work experience details" class="form-label">Mention your work experience details</label>
                    </div>
                    <div>

                    <textarea
                        class="form-control"
                        name="WorkExperienceDetails"
                        id="WorkExperienceDetails"
                        placeholder="Mention your work experience in detail"
                        rows="3"
                    ></textarea></div>
                </div>
                <div class="form-group mb-3 exclude-for-freshers" style="display: none;">
                    <div>
                        <label for="Do you have any other offer In-Hand?" class="form-label">Do you have any other offer In-hand?</label>
                    </div>
                    <div>
                    <select class="form-control" name="OtherOfferInHand" id="OtherOfferInHand">
                        <option value="" disabled selected>Select</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                    </div>

                </div>
                <div class="form-group mb-3 offer-details-field" style="display: none;">
                    <div>
                        <label for="Mention company & offer Details" class="form-label">Mention company & offer details</label>
                    </div>
                    <div>
                    <textarea
                        class="form-control"
                        name="CompanyOfferDetails"
                        id="CompanyOfferDetails"
                        placeholder="Mention company and offer details"
                        rows="3"
                    ></textarea>
                    </div>
                </div>


                <div class="form-group mb-3 only-for-freshers" style="display: none;">
                    <div>
                        <label for="If Fresher, would you like to join Immediately?" class="form-label">If Fresher, would you like to join Immediately?</label>
                    </div>
                    <div>         
                    <select class="form-control" name="JoinImmediately" id="JoinImmediately">
                        <option value="" disabled selected>Select</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                    </div>
                </div>
                <div class="form-group mb-3 reason-for-not-joining" style="display: none;">
                    <div>
                        <label for="Select a reason" class="form-label">Select a reason</label>
                    </div>
                   <div>
                    <select class="form-control" name="ReasonNotJoining" id="ReasonNotJoining" >
                        <option value="" disabled selected>Select</option>
                        <option value="Personal Reasons or family commitments">Personal Reasons or family commitments</option>
                        <option value="Academinc Commitments">Academic Commitments(for freshers)</option>
                        <option value="Relocation Requirements">Relocation Requirements</option>
                        <option value="Waiting for final semester results">Waiting for final semester results</option>
                        <option value="Pending offer negotations">Pending offer negotations</option>
                        <option value="Serving notice period at current organization">Serving notice period at current organization</option>
                        <option value="For any other, Contact HR to discuss">For any other, Contact HR to discuss</option>
                    </select>
                    </div>
                </div>
                <div class="form-group mb-3 notice-period-fields" style="display: none;"><div>
                    <label for="What is your notice period?" class="form-label">What is your notice period?</label>
                </div>
                    <div>
                    <input
                        type="text"
                        class="form-control"
                        name="NoticePeriodDuration"
                        id="NoticePeriodDuration"></div>
                </div>
                <div class="form-group mb-3 notice-period-fields" style="display: none;">
                    <div>
                        <label for="When is your last working date?" class="form-label">When is your last working date?</label>
                    </div>
                    <div>
                    <input
                        type="date"
                        class="form-control"
                        name="LastWorkingDate"
                        id="LastWorkingDate">
                        </div>
                </div>
                <div class="form-group mb-3 exclude-for-freshers" > 
                    <div>
                        <label for="Overall Experience" class="form-label">Overall Experience</label>
                    </div> 
                    <div>
                    <input type="number" class="form-control"
                        name="TotalExperience" id="TotalExperience"  min="0" max="50"
                        step="0.1"> </div>
                    </div>
                    <div class="form-group mb-3 exclude-for-freshers"> 
                        <div>
                            <label for="Relevant Experience" class="form-label">Relevant Experience</label>
                        </div>
                        <div>
                                
                        <input type="number" class="form-control"
                            name="RelevantExperience" id="RelevantExperience"  min="0" max="50"
                            step="0.1"> </div>
                            </div>
                            <div class="form-group mb-3 exclude-for-freshers"> 
                                <div>
                                    <label for="Other Domain Experience" class="form-label">Other Domain Experience</label>
                                </div>
                                <div>
                                <input type="number" class="form-control"
                                    name="DomainExperience" id="DomainExperience" min="0" max="50"
                                    step="0.1"> </div>
                            </div>
            <div class="input-group mb-3 "> <select class="form-control"
                    name="FunctionalOrTechnical" id="FunctionalOrTechnical" required>
                    <option value="" disabled selected>Expertise Functional or Technical</option>
                    <option value="Functional">Functional</option>
                    <option value="Technical">Technical</option>
                    <option value="Techno-Functional">Techno-Functional</option>
                </select> </div>
                <div class="form-group mb-3 exclude-for-freshers"> 
                    <div>
                        <label for="Current CTC" class="form-label">Current CTC in Lakhs</label>
                    </div>
                    <div>
                    <input type="number" class="form-control" name="CurrentCTC"
                        id="CurrentCTC" min="0" step="0.1" max="100"> </div>
                    </div>
                <div class="form-group mb-3 exclude-for-freshers"> 
        
                    <div>
                        <label for="Relevant Experience" class="form-label">Expected CTC in Lakhs</label>
                    </div>
                    <div>
                    <input
                        type="number" class="form-control" name="ExpectedCTC" id="ExpectedCTC"
                        placeholder="Expected CTC in Lakhs" min="0" step="0.1" max="100"> </div>
                        </div>
        
            <div class="input-group mb-3 exclude-for-freshers"><select class="form-control"
                    name="JoinerOrNotice" id="JoinerOrNotice">
                    <option value="" disabled selected>Immediate Joiner or Notice Period </option>
                    <option value="Immediate Joiner">Immediate Joiner</option>
                    <option value="Notice Period">Notice Period</option>
                </select> </div>
            <div class="input-group mb-3 exclude-for-freshers">  <input type="text" class="form-control"
                    name="NoOfDaysNotice" id="NoOfDaysNotice" placeholder="Notice Period No of days/No of months">
            </div>
            <div class="input-group mb-3 exclude-for-freshers"> <input
                    type="date" class="form-control" name="ServingDate" id="ServingDate"
                    placeholder="Notice Period Serving Last Date" onfocus="(this.type='date')"
                    onblur="(this.type='text')"> </div>
            <div class="input-group mb-3"> <select class="form-control" name="KnownCetas"
                    id="KnownCetas" required>
                    <option value="" disabled selected>How did you know us</option>
                    <option value="Cetas Website">Cetas Website</option>
                    <option value="LinkedIn">LinkedIn </option>
                    <option value="Friends">Friends</option>
                    <option value="Employee of Cetas">Refer by Cetas Employee</option>
                    <option value="Consultancy or Institute">Consultancy/Institute</option>
                    <option value="Walk-in">Walk-in</option>
                </select> </div>
            <div class="input-group mb-3">  <input
                    type="text" class="form-control" name="CertificateNo" id="CertificateNo"
                    placeholder="SSLC Certificate No" required></div>
            <div class="input-group mb-3">
                        <input type="date" class="form-control" name="ApproxDate" id="ApproxDate" placeholder="Approximate date to join in cetas " required>
                    </div>        
            <div class="input-group mb-3"> <input
                    type="file" class="form-control" name="resume" id="resume" accept=".pdf,.doc,.docx" required> </div> <button
                type="submit" class="btn btn-success w-100" name="submitBtn" id="submitBtn">Submit</button>
        </form>
        <div id="alert-container" class="mt-3"></div>
    </div>
    <script >
        const qrCodeApi = 'https://prod-28.centralindia.logic.azure.com:443/workflows/7aef9d67eff3430fb4b0e3713645f1fa/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=DtrtGCDpDk7zC3joiwckej5SE-gCTkgii9D5GPAZsNM'
const sendFormDataApi = 'https://prod-21.centralindia.logic.azure.com:443/workflows/f7f66b30e7fd48bb958f87b4709ac884/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=cB70JI-B5yysmOgU2jakbP1WEokKXQMzGT8XXpF7zmw'
const checkEmailExistsApi = 'https://prod-05.centralindia.logic.azure.com:443/workflows/88190902879844938d3f7b035a3f5e5d/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=MfkxpSPoqijaX8I61t1oqam6JRySCXYRagdIUU5GOug'
const checkCertificateNoExistsApi = 'https://prod-13.centralindia.logic.azure.com:443/workflows/4efaf94bd0bb450d9b6d08f8062983f4/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=hMrzzqWObIKqMjuRSBV5o42VP0hvoCyRtJvZfdpSFiw'

document.addEventListener("DOMContentLoaded", () => {
    initForm();
});

// 🔹 Initialization Function
function initForm() {
    const form = document.getElementById("registrationForm");

    setupExperienceFieldToggle();
    animateForm();
    form.addEventListener("submit", handleFormSubmit);
}

// 🔹 Experience Field Toggle for Freshers

function setupExperienceFieldToggle() {
    const expTypeSelect = document.getElementById("FresherOrExperience");
    const joinImmediatelySelect = document.getElementById("JoinImmediately");
    const reasonNotJoiningSelect = document.getElementById("ReasonNotJoining");
    const reasonForNotJoiningField = document.querySelector(".reason-for-not-joining");
    const noticePeriodFields = document.querySelectorAll(".notice-period-fields");
    const sameDomainSelect = document.getElementById("SameDomainExperience");
    const excludedFields = document.querySelectorAll(".exclude-for-freshers");
    const sameDomainField = document.querySelector(".same-domain-field");
    const workExperienceField = document.getElementById("WorkExperienceDetails").parentElement;
    const otherOfferField = document.getElementById("OtherOfferInHand").parentElement;
    const offerDetailsField = document.getElementById("CompanyOfferDetails").parentElement;
    const offerInHandSelect = document.getElementById("OtherOfferInHand");

   
    
    // Fields to toggle
    const domainExperienceField = document.getElementById("DomainExperience").parentElement;
    const relevantExperienceField = document.getElementById("RelevantExperience").parentElement;
    const totalExperienceField = document.getElementById("TotalExperience").parentElement;
    const currentCTCField = document.getElementById("CurrentCTC").parentElement;
    const expectedCTCField = document.getElementById("ExpectedCTC").parentElement;
    const offerInHandField = document.getElementById("OtherOfferInHand").parentElement;
    const noOfDaysNoticeField = document.getElementById("NoOfDaysNotice").parentElement;
    const joinerOrNoticeField = document.getElementById("JoinerOrNotice").parentElement;
    const servingDateField = document.getElementById("ServingDate").parentElement;
    const workExperienceDetailsField = document.getElementById("WorkExperienceDetails").parentElement;


    function toggleFields() {
        const isExperienced = expTypeSelect.value === "Experience";
        const isFresher = expTypeSelect.value === "Fresher";
        const fresherFields = document.querySelectorAll(".only-for-freshers");

        // Toggle "Experienced in Same Domain" field
        sameDomainField.style.display = isExperienced ? "flex" : "none";

        // Toggle fields for experienced candidates
        const excludedFields = document.querySelectorAll(".exclude-for-freshers");
        excludedFields.forEach(el => {
            el.style.display = "none";
            const input = el.querySelector("input, select");
            if (input) input.value = ""; // Clear values when hidden
           
        });
        const allFields = [
            domainExperienceField,
            relevantExperienceField,
            totalExperienceField,
            currentCTCField,
            expectedCTCField,
            offerInHandField,
            noOfDaysNoticeField,
            joinerOrNoticeField,
            servingDateField,
            workExperienceDetailsField,
        ];
        allFields.forEach(field => {
            field.style.display = "none";
            const input = field.querySelector("input, select, textarea");
            if (input) input.value = ""; // Clear values when hidden
        });
        if (sameDomainSelect) {
            sameDomainSelect.addEventListener("change", () => {
                const isSameDomainYes = sameDomainSelect.value === "Yes";
                const isSameDomainNo = sameDomainSelect.value === "No";

                if (isSameDomainYes) {
                    // Show fields for "Yes" in "Experienced in Same Domain"
                    domainExperienceField.style.display = "flex";
                    relevantExperienceField.style.display = "flex";
                    totalExperienceField.style.display = "flex";
                    currentCTCField.style.display = "flex";
                    expectedCTCField.style.display = "flex";
                    offerInHandField.style.display = "flex";
                    noOfDaysNoticeField.style.display = "flex";
                    joinerOrNoticeField.style.display = "flex";
                    servingDateField.style.display = "flex";
                }
                else if (isSameDomainNo) {
                    // Show fields for "No" in "Experienced in Same Domain"
                    workExperienceDetailsField.style.display = "flex";
                    relevantExperienceField.style.display = "none";
                    currentCTCField.style.display = "flex";
                    expectedCTCField.style.display = "flex";
                    offerInHandField.style.display = "flex";
                    joinerOrNoticeField.style.display = "flex";
                    domainExperienceField.style.display = "flex";
                    totalExperienceField.style.display = "flex";
                    noOfDaysNoticeField.style.display = "flex";
                    servingDateField.style.display = "flex";
                }
            });
        }
         // Clear and hide fields for experienced candidates
    excludedFields.forEach(el => {
        el.style.display = isExperienced ? "flex" : "none";
        const input = el.querySelector("input, select, textarea");
        if (!isExperienced && input) input.value = ""; // Clear values when hidden
    });

    // Toggle fields for freshers
    
    fresherFields.forEach(el => {
        el.style.display = isFresher ? "flex" : "none";
        const input = el.querySelector("input, select, textarea");
        if (input) {
            if (isFresher) {
                input.setAttribute("required", "required");
            } else {
                input.removeAttribute("required");
                input.value = ""; // Clear values when hidden
            }
        }
    });

        // Toggle "Reason for Not Joining Immediately" field
        if (joinImmediatelySelect) {
        joinImmediatelySelect.addEventListener("change", () => {
            const showReasonField = joinImmediatelySelect.value === "No";
            reasonForNotJoiningField.style.display = showReasonField ? "flex" : "none";

            // Dynamically handle the "required" attribute
            if (reasonNotJoiningSelect) {
                if (showReasonField) {
                    reasonNotJoiningSelect.setAttribute("required", "required");
                } else {
                    reasonNotJoiningSelect.removeAttribute("required");
                    reasonNotJoiningSelect.value = ""; // Clear the value when hidden
                }
            }
        });
    }
        // Toggle "Notice Period" fields
        if (reasonNotJoiningSelect) {
            reasonNotJoiningSelect.addEventListener("change", () => {
                const showNoticeFields = reasonNotJoiningSelect.value === "Serving notice period at current organization";
                noticePeriodFields.forEach(field => {
                    field.style.display = showNoticeFields ? "flex" : "none";
                    if (!showNoticeFields) {
                        const input = field.querySelector("input");
                        if (input) input.value = ""; // Clear values when hidden
                    }
                });
            });
        }
        // Toggle "Offer in Hand" details field
        if (offerInHandSelect) {
            offerInHandSelect.addEventListener("change", () => {
                const showOfferDetails = offerInHandSelect.value === "Yes";
                offerDetailsField.style.display = showOfferDetails ? "flex" : "none";
                if (!showOfferDetails) {
                    const input = offerDetailsField.querySelector("textarea");
                    if (input) input.value = ""; // Clear value when hidden
                }
            });
        }
        // Clear and hide fields for freshers
   
    fresherFields.forEach(el => {
        el.style.display = isFresher ? "flex" : "none";
        const input = el.querySelector("input, select, textarea");
        if (!isFresher && input) input.value = ""; // Clear values when hidden
    });
    }

    if (expTypeSelect) {
        expTypeSelect.addEventListener("change", toggleFields);
        toggleFields(); // Run on load
    }
}
// 🔹 Animate the form on load
function animateForm() {
    gsap.from("#form-container", {
        duration: 1,
        opacity: 0,
        y: -50,
        ease: "power2.out"
    });
}

async function handleFormSubmit(event) {
    event.preventDefault();
    console.log("Form submission started");

    const form = event.target;
    const phone = form.phone.value.trim();
    const dob = form.dob.value;
    const resumeFile = form.resume.files[0];
   
    const certificateNo = form.CertificateNo.value;
    const email = form.email.value;
    const fullname = form.fullname.value.trim();
    const fresherOrExperience = form.FresherOrExperience.value;
    
    const errorMessages = [];

    // 🔹 Fullname: 2-50 characters, letters and spaces only
    if (!/^[A-Za-z\s]{2,50}$/.test(fullname)) {
    document.getElementById("fullname-error").innerText = "❌ Full name must be 2 to 50 characters long and contain only letters and spaces.";
    errorMessages.push("❌ Full name is invalid.");}
     else {
    document.getElementById("fullname-error").innerText = ""; // Clear the error if valid
   }

    // 🔹 Email: basic email format check
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    document.getElementById("email-error").innerText = "❌ Please enter a valid email address.";
    errorMessages.push("❌ Email is invalid.");}
     else {
    document.getElementById("email-error").innerText = ""; // Clear the error if valid
}

    // 🔹 Phone Number Validation
    if (!/^[6-9]\d{9}$/.test(phone)) {
        errorMessages.push("❌ Invalid Phone Number");
    }

   

    // 🔹 Age Validation
    if (!isAtLeast18YearsOld(dob)) {
        errorMessages.push("❌ Please enter a valid date of birth. You must be at least 18 years old.");
    }

    // 🔹 Resume File Validation
   // 🔹 Resume File Validation
if (resumeFile) {
    const allowedExtensions = /\.(pdf|doc|docx)$/i;
    if (!allowedExtensions.test(resumeFile.name)) {
        errorMessages.push("❌ Resume must be a PDF, DOC, or DOCX file.");
    }
    if (resumeFile.size > 2 * 1024 * 1024) {
        errorMessages.push("❌ Resume file must be under 2MB.");
    }
}

    // Skip experience-related validations if "Fresher" is selected
    if (fresherOrExperience === "Experience") {
        const totalExperience = parseFloat(form.TotalExperience.value) || 0;
        const relevantExperience = parseFloat(form.RelevantExperience.value) || 0;
        const domainExperience = parseFloat(form.DomainExperience.value) || 0;
        const currentCTC = parseFloat(form.CurrentCTC.value) || 0;
        const expectedCTC = parseFloat(form.ExpectedCTC.value) || 0;
           // 🔹 Total Experience Validation

        if (isNaN(totalExperience) || totalExperience < 0 || totalExperience > 50) {
        errorMessages.push("❌ Total Experience must be between 0 and 50 years.");
    }

    // 🔹 Relevant Experience Validation
    if (isNaN(relevantExperience) || relevantExperience < 0 || relevantExperience > totalExperience) {
        errorMessages.push("❌ Relevant Experience must be between 0 and Total Experience.");
    }

    // 🔹 Domain Experience Validation
    // 🔹 Domain Experience Validation
    const maxDomainExperience = totalExperience - relevantExperience;
    if (isNaN(domainExperience) || domainExperience < 0 || domainExperience > maxDomainExperience) {
    errorMessages.push(`❌ Domain Experience must be between 0 and ${maxDomainExperience} years.`);
    }

        if (!form.FunctionalOrTechnical.value) {
            errorMessages.push("❌ Please select Functional or Technical expertise.");
        }
        // 🔹 Current CTC Validation
    if (isNaN(currentCTC) || currentCTC < 0 || currentCTC > 100) {
        errorMessages.push("❌ Current CTC must be between 0 and 100 Lakhs.");
    }

    // 🔹 Expected CTC Validation
    if (isNaN(expectedCTC) || expectedCTC < 0 || expectedCTC > 100) {
        errorMessages.push("❌ Expected CTC must be between 0 and 100 Lakhs.");
    }
           

        if (!form.JoinerOrNotice.value) {
            errorMessages.push("❌ Please select Immediate Joiner or Notice Period.");
        }

        if (form.JoinerOrNotice.value === "Notice Period") {
        if (!form.NoOfDaysNotice.value) {
        errorMessages.push("❌ Please provide the Notice Period duration.");
        }
        if (!form.ServingDate.value) {
        errorMessages.push("❌ Please provide the Notice Period Serving Last Date.");
        }
    }
    // 🔹 Certificate Number Validation
    if (!/^[A-Za-z0-9]{1,11}$/.test(certificateNo)) {
        errorMessages.push("❌ Certificate number must be up to 11 characters long and contain only numbers and optional alphabets.");
    }

   }

    // Show errors if any
    if (errorMessages.length) {
        showAlert(errorMessages.join("<br>"), "danger");
        return;
    }

    // 🔄 Check for duplicates
    // 🔄 Check for duplicates
const emailExists = await checkEmailExists(email);
const certificateExists = await checkCertificateNoExists(certificateNo);

if (emailExists || certificateExists) {
    const duplicateErrors = [];
    if (emailExists) duplicateErrors.push("This email has already been registered.");
    if (certificateExists) duplicateErrors.push("This certificate number has already been registered.");
    return showAlert(duplicateErrors.join("<br>"), "danger");
}
    // 🧾 Collect Form Data
    const formData = collectFormData(form);

    // Convert resume to base64
    if (resumeFile) {
        try {
            formData.resume = await toBase64(resumeFile);
            formData.filename = resumeFile.name;
        } catch (error) {
            console.error("File conversion error:", error);
            return showAlert("Failed to process resume file.", "danger");
        }
    }

    console.log("Form data:", formData);
    console.log("Sending data to API...");
    // 🚀 Submit form
    await sendFormData(formData, form);
}

// 🔹 Helper: Age Validation
function isAtLeast18YearsOld(dobStr) {
    if (!dobStr) {
        return false; // Return false if the dob field is empty
    }

    const dob = new Date(dobStr);
    if (isNaN(dob.getTime())) {
        return false; // Return false if the dob is an invalid date
    }

    const today = new Date();
    const minDate = new Date(today.setFullYear(today.getFullYear() - 18));
    return dob <= minDate; // Check if the dob is at least 18 years ago
 }

// 🔹 Helper: Collect Form Data
function collectFormData(form) {
    return {
        fullname: form.fullname.value.trim(),
        email: form.email.value.trim(),
        phone: form.phone.value.trim(),
        dob: form.dob.value || null, // Ensure null if empty
        college: form.college.value.trim(),
        education: form.education.value || null,
        Specialization: form.Specialization.value.trim(),
        resume: null,
        filename: "",
        FresherOrExperience: form.FresherOrExperience.value || null,
        JoinImmediately: form.FresherOrExperience.value === "Fresher" ? form.JoinImmediately.value || null : null,
        ReasonNotJoining: form.JoinImmediately && form.JoinImmediately.value === "No" ? form.ReasonNotJoining.value || null : null,
        NoticePeriodDuration: form.ReasonNotJoining && form.ReasonNotJoining.value === "Serving notice period at current organization" ? form.NoticePeriodDuration.value || null : null,
        LastWorkingDate: form.ReasonNotJoining && form.ReasonNotJoining.value === "Serving notice period at current organization" ? form.LastWorkingDate.value || null : null,
        SameDomainExperience: form.FresherOrExperience.value === "Experience" ? form.SameDomainExperience.value || null : null,
        WorkExperienceDetails: form.FresherOrExperience.value === "Experience" && form.SameDomainExperience.value === "No" ? form.WorkExperienceDetails.value.trim() || null : null,
        OtherOfferInHand: form.FresherOrExperience.value === "Experience" && form.SameDomainExperience.value ? form.OtherOfferInHand.value || null : null,
        CompanyOfferDetails: form.OtherOfferInHand && form.OtherOfferInHand.value === "Yes" ? form.CompanyOfferDetails.value.trim() || null : null,
        TotalExperience: form.FresherOrExperience.value === "Experience" ? parseFloat(form.TotalExperience.value) || null : null,
        RelevantExperience: form.FresherOrExperience.value === "Experience" && form.SameDomainExperience.value === "Yes" ? parseFloat(form.RelevantExperience.value) || null : null,
        DomainExperience: form.FresherOrExperience.value === "Experience" && form.SameDomainExperience.value === "Yes" ? parseFloat(form.DomainExperience.value) || null : null,
        FunctionalOrTechnical: form.FresherOrExperience.value === "Experience" && form.SameDomainExperience.value === "Yes" ? form.FunctionalOrTechnical.value || null : null,
        CurrentCTC: form.FresherOrExperience.value === "Experience" ? parseFloat(form.CurrentCTC.value) || null : null,
        ExpectedCTC: form.FresherOrExperience.value === "Experience" ? parseFloat(form.ExpectedCTC.value) || null : null,
        JoinerOrNotice: form.FresherOrExperience.value === "Experience" ? form.JoinerOrNotice.value || null : null,
        NoOfDaysNotice: form.FresherOrExperience.value === "Experience" ? form.NoOfDaysNotice.value || null : null,
        ServingDate: form.FresherOrExperience.value === "Experience" ? form.ServingDate.value || null : null,
        KnownCetas: form.KnownCetas.value || null,
        CertificateNo: form.CertificateNo.value.trim(),
        Gender: form.Gender.value || null,
        MaritalStatus: form.MaritalStatus.value || null,
        YOP: form.YOP.value || null,
        ApproxDate: form.ApproxDate.value || null
    };
}
// 🔹 Helper: Show Alert
function showAlert(message, type) {
    let alertBox = document.getElementById("alert-box");
    if (!alertBox) {
        alertBox = document.createElement("div");
        alertBox.id = "alert-box";
        alertBox.style.marginTop = "15px";
        document.getElementById("submitBtn").parentNode.appendChild(alertBox);
    }

    alertBox.innerHTML = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `;
    gsap.from(".alert", { duration: 0.5, opacity: 0, y: -10 });

    // Clear the alert after 5 seconds
    setTimeout(() => {
        const alertElement = document.querySelector(".alert");
        if (alertElement) {
            gsap.to(alertElement, {
                duration: 0.3,
                opacity: 0,
                y: -10,
                onComplete: () => {
                    alertBox.innerHTML = ""; // Clear the content
                }
            });
        }
    }, 5000); // Increased timeout duration to 5 seconds
}

// 🔹 Helper: Convert file to base64
function toBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}

// 🔹 API Calls
async function checkEmailExists(email) {
    try {
        const response = await fetch(checkEmailExistsApi, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
        });

        if (response.ok) {
            const data = await response.json();
            return data.emailExists || false;
        } else {
            const errorText = await response.text();
            console.error("Email check failed:", errorText);
            showAlert("Failed to check email. Please try again later.", "danger");
            return false;
        }
    } catch (error) {
        console.error("Network error during email check:", error);
        showAlert("Network error while checking email. Please try again later.", "danger");
        return false;
    }
}


async function checkCertificateNoExists(certificateNo) {
    try {
        const response = await fetch(checkCertificateNoExistsApi, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ CertificateNo: certificateNo })
        });

        if (response.ok) {
            const data = await response.json();
            return data.CertificateNoExists || false;
        } else {
            const errorText = await response.text();
            console.error("Certificate number check failed:", errorText);
            showAlert("Failed to check certificate number. Please try again later.", "danger");
            return false;
        }
    } catch (error) {
        console.error("Network error during certificate number check:", error);
        showAlert("Network error while checking certificate number. Please try again later.", "danger");
        return false;
    }
}

async function sendFormData(data, form) {
    try {
        const response = await fetch(sendFormDataApi, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            showAlert("Successfully submitted the form.", "success");
            form.reset();
            await sendQrCodeEmail(data.email);
        } else {
            const errorText = await response.text();
            console.error("Form submission failed:", errorText);
            showAlert(`Failed to submit the form: ${errorText}`, "danger");
        }
    } catch (error) {
        console.error("Network error during form submission:", error);
        showAlert("Network error while submitting the form. Please try again later.", "danger");
    }
}

async function sendQrCodeEmail(email) {
    try {
        const response = await fetch(qrCodeApi, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email })
        });

        if (!response.ok) {
            const errorText = await response.text();
            console.error("Failed to send QR Code email:", errorText);
            showAlert("Failed to send QR Code email. Please try again later.", "danger");
        }
    } catch (error) {
        console.error("Network error during QR Code email:", error);
        showAlert("Network error while sending QR Code email. Please try again later.", "danger");
    }
}
    </script>
</body>

</html>
