<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cetas Walk-in Interview Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css?family=Exo:400,700" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Poppins",sans-serif;
  }
  
  body {
    font-family: 'Exo', sans-serif;
    color: #333;
    background: linear-gradient(to right, #969696,#2E5461);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding-top: 100px;
    overflow-y: auto;
    position: relative;
  }
  
  .area {
    position: fixed;
    top: 0;
    left: 0;
    z-index: -2;
    width: 100%;
    height: 100vh;
    background: linear-gradient(135deg, #4e54c8, #707072);
  }
  
 

  
  /* Header */
  header {
    width: 100%;
    position: fixed;
    top: 0;
    left: 0;
    background:#24323d;
    padding: 14px 0;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  .header-container {
    display: flex;
    align-items: center;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 15px;
    position: relative;
  }
  
  
  .header-logo {
    height: 45px;
    width: auto;
    position: absolute;
    left: 15px;
    object-fit: contain;
  }
  
  .header-title {
    font-size: 18px;
    font-weight: 500;
    color: white;
    width: 100%;
    text-align: center;
    padding-left: 35px;
  }
  input.form-control::-webkit-input-placeholder {
        color: #24323d; /* Chrome, Safari, Edge */
    }

    input.form-control:-ms-input-placeholder {
        color: #24323d; /* Internet Explorer */
    }

    input.form-control::-ms-input-placeholder {
        color: #24323d; /* Microsoft Edge */
    }

    input.form-control::placeholder {
        color: #24323d; /* Standard */
    }

   
  /* Form Container */
  .container {
    background: #24323d;
    backdrop-filter: blur(8px);
    color: #1ab188;
    font-weight: 600px;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    max-width: 600px;
    width: 100%;
    text-align: center;
    z-index: 10;
    margin: 30px auto 100px;
    border: 1px solid rgba(255, 255, 255, 0.3);
  }
  
  /* Inputs & Buttons */

  
  .form-control {
    border: 1px solid #ccc;
    position: relative;
    width: 100%;
    padding: 10px 10px 10px 10px;
    outline:none;
    border:none;
    border-radius: 10px;


    color:#24323d;
    transition: box-shadow 0.2s ease;
  }
  
  .form-control:focus {
    box-shadow: 0 0 0 2px rgba(5, 67, 148, 0.2);
  }
  
  .btn-success {
    background-color: #1ab188;
    border: none;
    outline: none;
    padding: 10px;
    border-radius: 10px;
    color: #fff;
    font-size: 16px;
    transform:0.3s ease;
    cursor: pointer;;    
    transition: all 0.3s ease-in-out;
  }
  
  .btn-success:hover {
    background-color: #1ec79a;
    transform: scale(1.05);
  
  }
  
  /* Responsive tweaks */
  @media (max-width: 768px) {
    .header-logo { height: 35px; }
    .header-title { font-size: 16px; margin-left: 40px; }
  }
  
  @media (max-width: 580px) {
    .header-logo { display: none; }
    .header-title { margin-left: 0; text-align: center; }
  }
  
  @media (max-width: 480px) {
    .header-title { font-size: 14px; }
    body { padding-top: 110px; }
  }
  
    </style>
</head>

<body>
   
    <header>
        <div class="header-container"> <img src="https://i.ibb.co/CpZ0F5dk/Cetas-Logo-White.png" alt="Cetas Logo"
                class="header-logo">
            <div class="header-title">Cetas Walk-in Interview Registration</div>
        </div>
    </header>
    <div class="container" id="form-container">
        <h2 class="mb-4">Register</h2>
       <!-- START: Registration Form -->
<form id="registrationForm">
  <!-- Full Name -->
  <div class="input-group mb-3">
    <label for="fullname">Full Name</label>
    <input type="text" class="form-control" name="fullname" id="fullname" placeholder="Full Name" required>
  </div>
  <div id="fullname-error" class="text-danger"></div>

  <!-- Email -->
  <div class="input-group mb-3">
    <label for="email">Email</label>
    <input type="email" class="form-control" name="email" id="email" placeholder="Email" required>
  </div>
  <div id="email-error" class="text-danger"></div>

  <!-- Phone -->
  <div class="input-group mb-3">
    <label for="phone">Phone</label>
    <input type="text" class="form-control" name="phone" id="phone" placeholder="Phone" required>
  </div>

  <!-- Date of Birth -->
  <div class="input-group mb-3">
    <label for="dob">Date of Birth</label>
    <input type="date" class="form-control" name="dob" id="dob" required>
  </div>

  <!-- Gender -->
  <div class="input-group mb-3">
    <label for="Gender">Gender</label>
    <select class="form-control" name="Gender" id="Gender" required>
      <option value="" disabled selected>Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>
  </div>

  <!-- Marital Status -->
  <div class="input-group mb-3">
    <label for="MaritalStatus">Marital Status</label>
    <select class="form-control" name="MaritalStatus" id="MaritalStatus" required>
      <option value="" disabled selected>Marital Status</option>
      <option value="Single">Single</option>
      <option value="Married">Married</option>
    </select>
  </div>

  <!-- College Name -->
  <div class="input-group mb-3">
    <label for="college">College Name</label>
    <input type="text" class="form-control" name="college" id="college" placeholder="College Name" required>
  </div>

  <!-- Education -->
  <div class="input-group mb-3">
    <label for="education">Educational Qualification</label>
    <select class="form-control" name="education" id="education" required>
      <option value="" disabled selected>Educational Qualification</option>
      <option value="Undergraduate">Undergraduate</option>
      <option value="Postgraduate">Postgraduate</option>
      <option value="Doctorate">Doctorate</option>
      <option value="In College">In College</option>
    </select>
  </div>

  <!-- Specialization -->
  <div class="input-group mb-3">
    <label for="Specialization">Specialization</label>
    <input type="text" class="form-control" name="Specialization" id="Specialization" placeholder="Enter your Specialization" required>
  </div>

  <!-- Year of Passing -->
  <div class="input-group mb-3">
    <label for="YOP">Year Of Passing</label>
    <select class="form-control" name="YOP" id="YOP" required>
      <option value="" disabled selected>Year Of Passing</option>
      <option value="2025">2025</option>
      <option value="2024">2024</option>
      <option value="2023">2023</option>
      <option value="2022">2022</option>
      <option value="2021">2021</option>
      <option value="<2020"><2020</option>
    </select>
  </div>

  <!-- Fresher or Experienced -->
  <div class="input-group mb-3">
    <label for="FresherOrExperience">Fresher or Experienced</label>
    <select class="form-control" name="FresherOrExperience" id="FresherOrExperience" required>
      <option value="" disabled selected>Fresher or Experienced</option>
      <option value="Fresher">Fresher</option>
      <option value="Experience">Experience</option>
    </select>
  </div>

  <!-- The rest of the fields follow same structure... -->

  <!-- Upload Resume -->
  <div class="input-group mb-3">
    <label for="resume">Upload Resume</label>
    <input type="file" class="form-control" name="resume" id="resume" accept=".pdf,.doc,.docx" required>
  </div>

  <!-- Submit Button -->
  <button type="submit" class="btn btn-success w-100" name="submitBtn" id="submitBtn">Submit</button>
</form>
<!-- END: Registration Form -->

        <div id="alert-container" class="mt-3"></div>
    </div>
    <script >
        const qrCodeApi = 'https://prod-28.centralindia.logic.azure.com:443/workflows/7aef9d67eff3430fb4b0e3713645f1fa/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=DtrtGCDpDk7zC3joiwckej5SE-gCTkgii9D5GPAZsNM'
const sendFormDataApi = "https://prod-21.centralindia.logic.azure.com:443/workflows/f7f66b30e7fd48bb958f87b4709ac884/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=cB70JI-B5yysmOgU2jakbP1WEokKXQMzGT8XXpF7zmw"
const checkEmailExistsApi = 'https://prod-05.centralindia.logic.azure.com:443/workflows/88190902879844938d3f7b035a3f5e5d/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=MfkxpSPoqijaX8I61t1oqam6JRySCXYRagdIUU5GOug'
const checkCertificateNoExistsApi = 'https://prod-13.centralindia.logic.azure.com:443/workflows/4efaf94bd0bb450d9b6d08f8062983f4/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=hMrzzqWObIKqMjuRSBV5o42VP0hvoCyRtJvZfdpSFiw'

document.addEventListener("DOMContentLoaded", () => {
    initForm();
});

// 🔹 Initialization Function
function initForm() {
    const form = document.getElementById("registrationForm");

    setupExperienceFieldToggle();
    animateForm();
    form.addEventListener("submit", handleFormSubmit);
}

// 🔹 Experience Field Toggle for Freshers

function setupExperienceFieldToggle() {
    const expTypeSelect = document.getElementById("FresherOrExperience");
    const joinImmediatelySelect = document.getElementById("JoinImmediately");
    const reasonNotJoiningSelect = document.getElementById("ReasonNotJoining");
    const reasonForNotJoiningField = document.querySelector(".reason-for-not-joining");
    const noticePeriodFields = document.querySelectorAll(".notice-period-fields");
    const sameDomainSelect = document.getElementById("SameDomainExperience");
    const excludedFields = document.querySelectorAll(".exclude-for-freshers");
    const sameDomainField = document.querySelector(".same-domain-field");
    const workExperienceField = document.getElementById("WorkExperienceDetails").parentElement;
    const otherOfferField = document.getElementById("OtherOfferInHand").parentElement;
    const offerDetailsField = document.getElementById("CompanyOfferDetails").parentElement;
    const offerInHandSelect = document.getElementById("OtherOfferInHand");

   
    
    // Fields to toggle
    const domainExperienceField = document.getElementById("DomainExperience").parentElement;
    const relevantExperienceField = document.getElementById("RelevantExperience").parentElement;
    const totalExperienceField = document.getElementById("TotalExperience").parentElement;
    const currentCTCField = document.getElementById("CurrentCTC").parentElement;
    const expectedCTCField = document.getElementById("ExpectedCTC").parentElement;
    const offerInHandField = document.getElementById("OtherOfferInHand").parentElement;
    const noOfDaysNoticeField = document.getElementById("NoOfDaysNotice").parentElement;
    const joinerOrNoticeField = document.getElementById("JoinerOrNotice").parentElement;
    const servingDateField = document.getElementById("ServingDate").parentElement;
    const workExperienceDetailsField = document.getElementById("WorkExperienceDetails").parentElement;


    function toggleFields() {
        const isExperienced = expTypeSelect.value === "Experience";
        const isFresher = expTypeSelect.value === "Fresher";
                       // Toggle "Experienced in Same Domain" field
        sameDomainField.style.display = isExperienced ? "flex" : "none";

        // Toggle fields for experienced candidates
        const excludedFields = document.querySelectorAll(".exclude-for-freshers");
        excludedFields.forEach(el => {
            el.style.display = "none";
            const input = el.querySelector("input, select");
            if (input) input.value = ""; // Clear values when hidden
           
        });
        const allFields = [
            domainExperienceField,
            relevantExperienceField,
            totalExperienceField,
            currentCTCField,
            expectedCTCField,
            offerInHandField,
            noOfDaysNoticeField,
            joinerOrNoticeField,
            servingDateField,
            workExperienceDetailsField,
        ];
        allFields.forEach(field => {
            field.style.display = "none";
            const input = field.querySelector("input, select, textarea");
            if (input) input.value = ""; // Clear values when hidden
        });
        if (sameDomainSelect) {
            sameDomainSelect.addEventListener("change", () => {
                const isSameDomainYes = sameDomainSelect.value === "Yes";
                const isSameDomainNo = sameDomainSelect.value === "No";

                if (isSameDomainYes) {
                    // Show fields for "Yes" in "Experienced in Same Domain"
                    domainExperienceField.style.display = "flex";
                    relevantExperienceField.style.display = "flex";
                    totalExperienceField.style.display = "flex";
                    currentCTCField.style.display = "flex";
                    expectedCTCField.style.display = "flex";
                    offerInHandField.style.display = "flex";
                    noOfDaysNoticeField.style.display = "flex";
                    joinerOrNoticeField.style.display = "flex";
                    servingDateField.style.display = "flex";
                }
                else if (isSameDomainNo) {
                    // Show fields for "No" in "Experienced in Same Domain"
                    workExperienceDetailsField.style.display = "flex";
                    relevantExperienceField.style.display = "none";
                    currentCTCField.style.display = "flex";
                    expectedCTCField.style.display = "flex";
                    offerInHandField.style.display = "flex";
                    joinerOrNoticeField.style.display = "flex";
                    domainExperienceField.style.display = "flex";
                    totalExperienceField.style.display = "flex";
                    noOfDaysNoticeField.style.display = "flex";
                    servingDateField.style.display = "flex";
                }
            });
        }


 
        // Toggle "Join Immediately" field for freshers
        const fresherFields = document.querySelectorAll(".only-for-freshers");
        fresherFields.forEach(el => {
            el.style.display = isFresher ? "flex" : "none";
            if (!isFresher) {
                const input = el.querySelector("input, select");
                if (input) input.value = ""; // Clear values when hidden
            }
        });

        // Toggle "Reason for Not Joining Immediately" field
        if (joinImmediatelySelect) {
        joinImmediatelySelect.addEventListener("change", () => {
            const showReasonField = joinImmediatelySelect.value === "No";
            reasonForNotJoiningField.style.display = showReasonField ? "flex" : "none";

            // Dynamically handle the "required" attribute
            if (reasonNotJoiningSelect) {
                if (showReasonField) {
                    reasonNotJoiningSelect.setAttribute("required", "required");
                } else {
                    reasonNotJoiningSelect.removeAttribute("required");
                    reasonNotJoiningSelect.value = ""; // Clear the value when hidden
                }
            }
        });
    }
        // Toggle "Notice Period" fields
        if (reasonNotJoiningSelect) {
            reasonNotJoiningSelect.addEventListener("change", () => {
                const showNoticeFields = reasonNotJoiningSelect.value === "Serving notice period at current organization";
                noticePeriodFields.forEach(field => {
                    field.style.display = showNoticeFields ? "flex" : "none";
                    if (!showNoticeFields) {
                        const input = field.querySelector("input");
                        if (input) input.value = ""; // Clear values when hidden
                    }
                });
            });
        }
        // Toggle "Offer in Hand" details field
        if (offerInHandSelect) {
            offerInHandSelect.addEventListener("change", () => {
                const showOfferDetails = offerInHandSelect.value === "Yes";
                offerDetailsField.style.display = showOfferDetails ? "flex" : "none";
                if (!showOfferDetails) {
                    const input = offerDetailsField.querySelector("textarea");
                    if (input) input.value = ""; // Clear value when hidden
                }
            });
        }
    }

    if (expTypeSelect) {
        expTypeSelect.addEventListener("change", toggleFields);
        toggleFields(); // Run on load
    }
}
// 🔹 Animate the form on load
function animateForm() {
    gsap.from("#form-container", {
        duration: 1,
        opacity: 0,
        y: -50,
        ease: "power2.out"
    });
}

async function handleFormSubmit(event) {
    event.preventDefault();
    console.log("Form submission started");

    const form = event.target;
    const phone = form.phone.value.trim();
    const dob = form.dob.value;
    const resumeFile = form.resume.files[0];
   
    const certificateNo = form.CertificateNo.value;
    const email = form.email.value;
    const fullname = form.fullname.value.trim();
    const fresherOrExperience = form.FresherOrExperience.value;

    const errorMessages = [];

    // 🔹 Fullname: 2-50 characters, letters and spaces only
    if (!/^[A-Za-z\s]{2,50}$/.test(fullname)) {
    document.getElementById("fullname-error").innerText = "❌ Full name must be 2 to 50 characters long and contain only letters and spaces.";
    errorMessages.push("❌ Full name is invalid.");}
     else {
    document.getElementById("fullname-error").innerText = ""; // Clear the error if valid
   }

    // 🔹 Email: basic email format check
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    document.getElementById("email-error").innerText = "❌ Please enter a valid email address.";
    errorMessages.push("❌ Email is invalid.");}
     else {
    document.getElementById("email-error").innerText = ""; // Clear the error if valid
}

    // 🔹 Phone Number Validation
    if (!/^[6-9]\d{9}$/.test(phone)) {
        errorMessages.push("❌ Invalid Phone Number");
    }

   

    // 🔹 Age Validation
    if (!isAtLeast18YearsOld(dob)) {
        errorMessages.push("❌ Please enter a valid date of birth. You must be at least 18 years old.");
    }

    // 🔹 Resume File Validation
   // 🔹 Resume File Validation
if (resumeFile) {
    const allowedExtensions = /\.(pdf|doc|docx)$/i;
    if (!allowedExtensions.test(resumeFile.name)) {
        errorMessages.push("❌ Resume must be a PDF, DOC, or DOCX file.");
    }
    if (resumeFile.size > 2 * 1024 * 1024) {
        errorMessages.push("❌ Resume file must be under 2MB.");
    }
}

    // Skip experience-related validations if "Fresher" is selected
    if (fresherOrExperience === "Experience") {
        const totalExperience = parseFloat(form.TotalExperience.value) || 0;
        const relevantExperience = parseFloat(form.RelevantExperience.value) || 0;
        const domainExperience = parseFloat(form.DomainExperience.value) || 0;
        const currentCTC = parseFloat(form.CurrentCTC.value) || 0;
        const expectedCTC = parseFloat(form.ExpectedCTC.value) || 0;
           // 🔹 Total Experience Validation

        if (isNaN(totalExperience) || totalExperience < 0 || totalExperience > 50) {
        errorMessages.push("❌ Total Experience must be between 0 and 50 years.");
    }

    // 🔹 Relevant Experience Validation
    if (isNaN(relevantExperience) || relevantExperience < 0 || relevantExperience > totalExperience) {
        errorMessages.push("❌ Relevant Experience must be between 0 and Total Experience.");
    }

    // 🔹 Domain Experience Validation
    // 🔹 Domain Experience Validation
    const maxDomainExperience = totalExperience - relevantExperience;
    if (isNaN(domainExperience) || domainExperience < 0 || domainExperience > maxDomainExperience) {
    errorMessages.push(`❌ Domain Experience must be between 0 and ${maxDomainExperience} years.`);
    }

        if (!form.FunctionalOrTechnical.value) {
            errorMessages.push("❌ Please select Functional or Technical expertise.");
        }
        // 🔹 Current CTC Validation
    if (isNaN(currentCTC) || currentCTC < 0 || currentCTC > 100) {
        errorMessages.push("❌ Current CTC must be between 0 and 100 Lakhs.");
    }

    // 🔹 Expected CTC Validation
    if (isNaN(expectedCTC) || expectedCTC < 0 || expectedCTC > 100) {
        errorMessages.push("❌ Expected CTC must be between 0 and 100 Lakhs.");
    }
           

        if (!form.JoinerOrNotice.value) {
            errorMessages.push("❌ Please select Immediate Joiner or Notice Period.");
        }

        if (form.JoinerOrNotice.value === "Notice Period") {
        if (!form.NoOfDaysNotice.value) {
        errorMessages.push("❌ Please provide the Notice Period duration.");
        }
        if (!form.ServingDate.value) {
        errorMessages.push("❌ Please provide the Notice Period Serving Last Date.");
        }
    }
    // 🔹 Certificate Number Validation
    if (!/^[A-Za-z0-9]{1,11}$/.test(certificateNo)) {
        errorMessages.push("❌ Certificate number must be up to 11 characters long and contain only numbers and optional alphabets.");
    }

   }

    // Show errors if any
    if (errorMessages.length) {
        showAlert(errorMessages.join("<br>"), "danger");
        return;
    }

    // 🔄 Check for duplicates
    // 🔄 Check for duplicates
const emailExists = await checkEmailExists(email);
const certificateExists = await checkCertificateNoExists(certificateNo);

if (emailExists || certificateExists) {
    const duplicateErrors = [];
    if (emailExists) duplicateErrors.push("This email has already been registered.");
    if (certificateExists) duplicateErrors.push("This certificate number has already been registered.");
    return showAlert(duplicateErrors.join("<br>"), "danger");
}
    // 🧾 Collect Form Data
    const formData = collectFormData(form);

    // Convert resume to base64
    if (resumeFile) {
        try {
            formData.resume = await toBase64(resumeFile);
            formData.filename = resumeFile.name;
        } catch (error) {
            console.error("File conversion error:", error);
            return showAlert("Failed to process resume file.", "danger");
        }
    }

    console.log("Form data:", formData);
    console.log("Sending data to API...");
    // 🚀 Submit form
    await sendFormData(formData, form);
}

// 🔹 Helper: Age Validation
function isAtLeast18YearsOld(dobStr) {
    if (!dobStr) {
        return false; // Return false if the dob field is empty
    }

    const dob = new Date(dobStr);
    if (isNaN(dob.getTime())) {
        return false; // Return false if the dob is an invalid date
    }

    const today = new Date();
    const minDate = new Date(today.setFullYear(today.getFullYear() - 18));
    return dob <= minDate; // Check if the dob is at least 18 years ago
 }

// 🔹 Helper: Collect Form Data
function collectFormData(form) {
    return {
        fullname: form.fullname.value.trim(),
        email: form.email.value.trim(),
        phone: form.phone.value.trim(),
        dob: form.dob.value || null,
        college: form.college.value.trim(),
        education: form.education.value,
        Specialization: form.Specialization.value.trim(),
        resume: null,
        filename: "",
        FresherOrExperience: form.FresherOrExperience.value || null,
        JoinImmediately: form.FresherOrExperience.value === "Fresher" ? form.JoinImmediately.value || null : null,
        ReasonNotJoining: form.JoinImmediately && form.JoinImmediately.value === "No" ? form.ReasonNotJoining.value || null : null,
        NoticePeriodDuration: form.ReasonNotJoining && form.ReasonNotJoining.value === "Serving notice period at current organization" ? form.NoticePeriodDuration.value || null : null,
        LastWorkingDate: form.ReasonNotJoining && form.ReasonNotJoining.value === "Serving notice period at current organization" ? form.LastWorkingDate.value || null : null,
        SameDomainExperience: form.FresherOrExperience.value === "Experience" ? form.SameDomainExperience.value || null : null,
        WorkExperienceDetails: form.FresherOrExperience.value === "Experience" && form.SameDomainExperience.value === "No" ? form.WorkExperienceDetails.value.trim() || null : null,
        OtherOfferInHand: form.FresherOrExperience.value === "Experience" && form.SameDomainExperience.value ? form.OtherOfferInHand.value || null : null,
        CompanyOfferDetails: form.OtherOfferInHand && form.OtherOfferInHand.value === "Yes" ? form.CompanyOfferDetails.value.trim() || null : null, // New field
        TotalExperience: form.FresherOrExperience.value === "Experience" ? parseFloat(form.TotalExperience.value) || null : null,
        RelevantExperience: form.FresherOrExperience.value === "Experience" && form.SameDomainExperience.value === "Yes" ? parseFloat(form.RelevantExperience.value) || null : null,
        DomainExperience: form.FresherOrExperience.value === "Experience" && form.SameDomainExperience.value === "Yes" ? parseFloat(form.DomainExperience.value) || null : null,
        FunctionalOrTechnical: form.FresherOrExperience.value === "Experience" && form.SameDomainExperience.value === "Yes" ? form.FunctionalOrTechnical.value || null : null,
        CurrentCTC: form.FresherOrExperience.value === "Experience" ? parseFloat(form.CurrentCTC.value) || null : null,
        ExpectedCTC: form.FresherOrExperience.value === "Experience" ? parseFloat(form.ExpectedCTC.value) || null : null,
        JoinerOrNotice: form.FresherOrExperience.value === "Experience" ? form.JoinerOrNotice.value || null : null,
        NoOfDaysNotice: form.FresherOrExperience.value === "Experience" ? form.NoOfDaysNotice.value || null : null,
        ServingDate: form.FresherOrExperience.value === "Experience" ? form.ServingDate.value || null : null,
        KnownCetas: form.KnownCetas.value,
        CertificateNo: form.CertificateNo.value.trim(),
        Gender: form.Gender.value || null,
        MaritalStatus: form.MaritalStatus.value || null,
        YOP: form.YOP.value,
        ApproxDate: form.ApproxDate.value || null
    };
}


// 🔹 Helper: Show Alert
function showAlert(message, type) {
    let alertBox = document.getElementById("alert-box");
    if (!alertBox) {
        alertBox = document.createElement("div");
        alertBox.id = "alert-box";
        alertBox.style.marginTop = "15px";
        document.getElementById("submitBtn").parentNode.appendChild(alertBox);
    }

    alertBox.innerHTML = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `;
    gsap.from(".alert", { duration: 0.5, opacity: 0, y: -10 });

    // Clear the alert after 5 seconds
    setTimeout(() => {
        const alertElement = document.querySelector(".alert");
        if (alertElement) {
            gsap.to(alertElement, {
                duration: 0.3,
                opacity: 0,
                y: -10,
                onComplete: () => {
                    alertBox.innerHTML = ""; // Clear the content
                }
            });
        }
    }, 5000); // Increased timeout duration to 5 seconds
}

// 🔹 Helper: Convert file to base64
function toBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}

// 🔹 API Calls
async function checkEmailExists(email) {
    try {
        const response = await fetch(checkEmailExistsApi, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
        });

        if (response.ok) {
            const data = await response.json();
            return data.emailExists || false;
        } else {
            const errorText = await response.text();
            console.error("Email check failed:", errorText);
            showAlert("Failed to check email. Please try again later.", "danger");
            return false;
        }
    } catch (error) {
        console.error("Network error during email check:", error);
        showAlert("Network error while checking email. Please try again later.", "danger");
        return false;
    }
}


async function checkCertificateNoExists(certificateNo) {
    try {
        const response = await fetch(checkCertificateNoExistsApi, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ CertificateNo: certificateNo })
        });

        if (response.ok) {
            const data = await response.json();
            return data.CertificateNoExists || false;
        } else {
            const errorText = await response.text();
            console.error("Certificate number check failed:", errorText);
            showAlert("Failed to check certificate number. Please try again later.", "danger");
            return false;
        }
    } catch (error) {
        console.error("Network error during certificate number check:", error);
        showAlert("Network error while checking certificate number. Please try again later.", "danger");
        return false;
    }
}

async function sendFormData(data, form) {
    try {
        const response = await fetch(sendFormDataApi, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            showAlert("Successfully submitted the form.", "success");
            form.reset();
            await sendQrCodeEmail(data.email);
        } else {
            const errorText = await response.text();
            console.error("Form submission failed:", errorText);
            showAlert(`Failed to submit the form: ${errorText}`, "danger");
        }
    } catch (error) {
        console.error("Network error during form submission:", error);
        showAlert("Network error while submitting the form. Please try again later.", "danger");
    }
}

async function sendQrCodeEmail(email) {
    try {
        const response = await fetch(qrCodeApi, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email })
        });

        if (!response.ok) {
            const errorText = await response.text();
            console.error("Failed to send QR Code email:", errorText);
            showAlert("Failed to send QR Code email. Please try again later.", "danger");
        }
    } catch (error) {
        console.error("Network error during QR Code email:", error);
        showAlert("Network error while sending QR Code email. Please try again later.", "danger");
    }
}
    </script>
</body>

</html>
